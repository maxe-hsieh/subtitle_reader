# 更新日誌

## V2.9, 2023.11.18

版本代號： perfect slumbers

BGM Source:
https://youtu.be/rQNaWSMCA0A

### 新增項目

1. 新增 NVDA 在 Pot Player 朗讀字幕時的錯誤修正。
其實就是出現兩行字幕時，下個時間點的字幕只有一行改變時會重複朗讀的錯誤。
2. 新增愛奇藝國際版的字幕支援
測試影片：[葬送的芙莉蓮 - 第1話 - 冒險結束](https://www.iq.com/play/%E8%91%AC%E9%80%81%E7%9A%84%E8%8A%99%E8%8E%89%E8%93%AE-%E7%AC%AC1%E9%9B%86-270u52u7a54)
3. 新增猫耳FM的字幕支援
這裡的字幕很奇怪，居然跟弹幕混再一起，使得需要花時間從弹幕裡面找出字幕，弹幕越密集，速度就越慢，但請放心，不會影響 NVDA 的速度。
另一個問題就是畫面上的字幕出現很久才會消失，也就是說畫面上同時有兩行相同的字幕，即使是間隔一段時間才出來的也會被當作是已經朗讀過的字幕。
測試影片：[莫晨欢原著｜《地球上线》广播剧·第四季·定档预告](https://www.missevan.com/sound/player?id=8350654)
3. 字幕閱讀器現在不會在安全桌面執行。

### 修改項目

1. 從下一個版本開始，當閱讀器發現新版本時出現版本資訊視窗，絕對不會再切換視窗了。
2. 現在當載入 BGM 時，不會在卡住 NVDA 與視窗的操作了。

### 修正項目

1. 全面忽略當字幕物件消失或被更換時產生的操作異常，上個版本在有轉錄稿得 Youtube 影片容易出現異常。

---

## V2.83, 2023.8.3

版本代號：若能化為星座

Source:
https://youtu.be/wSTbdqo-j74

### 修正項目

1. 修正在閱讀字幕時，可能因為字幕的消失，導致偶爾會出現的錯誤。
2. 修正 Marumaru 在內嵌 Youtube 影片本身有字幕時，無法朗讀任何字幕的錯誤。
3. 修正自動更新的視窗非常小，以及內部控見隨意設定，導致混亂的排序且無法顯示在畫面上，也無法使用滑鼠操作的錯誤。
自動更新的介面事非常久以前寫的了，原來我以前不懂怎麼寫樣式就隨便亂寫哈哈。
而現在我有《物件位置音效》這個附加元件可以輕鬆確認每個元件的位置與大小了，所以看著文件以及根據之前在課堂學習的記憶進行調整了，雖然還有一小部分沒有達到我想要的樣式，但那就等到我有機會找到明眼人幫我看過之後再繼續調整吧。
視窗的修正需要等到更新之後才會生效。

---

## V2.82, 2023.8.2

版本代號：魚

Source:
https://youtu.be/aQtf3gEuejE

### 新增項目

1. 新增義大利語，感謝 Ambrogio Riili
2. 新增阿拉伯語，感謝 MesterPerfect
3. 更新烏克蘭語，感謝 VovaMobile

### 修正巷木

1. 修正 objectFinder 導致容易出現異常的錯誤。
2. 修正 FireFox 無法朗讀字幕的錯誤，感謝 Carlos Esteban Mart
3. 修正無法自動檢查更新的錯誤，舊的代碼又回來了 ...
4. 修正說明文件，他不應該帶有版本號。

---

## V2.81, 2023.7.12

版本代號：流星會降落在你心上

source:
https://youtu.be/TEVp99ulq-w

### 新增項目

1. 完善英文語言翻譯。
2. 完善烏克蘭語言翻譯，感謝 VovaMobile!
3. 新增芬蘭語言，感謝 jkinnunen!
4. 新增西班牙語言，感謝 Carlos-EstebanM!

### 修正巷木

1. 修正 Bilibili 在朗讀多行字幕時會重複朗讀的錯誤。感謝 Eureka 發現問題並提供測試影片。
測試影片：[[中英字幕] 数据结构 容易进阶的完整课程 · 由 Google 工程师 WilliamFiset 创作](https://www.bilibili.com/video/BV15V411t7KL/?spm_id_from=333.337.search-card.all.click&vd_source=d94501c394f4ec46b2df7bc5760d4592)
2. 修正字幕閱讀器無法閱讀 Youtube Shorts 影片的錯誤。

---

## V2.8, 2023.4.18

版本代號：禁忌的邊界線

### 新增項目

1. Youtube 聊天室：新增朗讀訊息發送者及其對應開關。
2. Youtube 聊天室：新增朗讀會籍贈送訊息及其對應開關。
3. 新增 Bilibili 字幕支援，感謝 Eureka 在 NVDA 台灣的提案。

### 修改項目

1. 字幕閱讀器核心：將尋找字幕或聊天室較慢的程式改為非同步進行，避免字幕閱讀器讓 NVDA 反應速度變慢。
P.S 這是此版本最大的更新，並且可能不穩定，未來將可能出現頻率較高的修正版。
現在不用擔心閱讀器找字幕或聊天室，因為網頁元素太多而花較長的時間了，閱讀器跑起來吧，快 ... 還要更快。
2. Netflix: 調整尋找字幕的方式，使得當開啟 Teleparty 實惠找不到字幕的問題，感謝 T.Y 思訓反映此問題。

### 修正巷木

1. 修正再輸入手勢當中找不到字幕閱讀器的錯誤 (issue #5) 。

---

## V2.7, 2023.3.12

版本代號：來自心中的訊息

### 新增項目

1. Youtube: 新增閱讀聊天室的功能，預設惠掠過聊天室當中的圖片，可以再選單進行設定。
建議用於聊天速度不快的直播，通常可以從當下正在觀看的人數判斷，不過也有例外，比如 Muse 某些動漫的馬拉松直播，或是某些背景音樂的直播。
2. Youtube： 新增閱讀 Short 影片字幕的功能

P.S 以上功能暫時針對 Chromium
考慮之後若有兩三個 Firefox 使用者覺得此功能很重要並找我反映的話再來支援。
好想放棄 Firefox .....

### 修改項目

1. 修改閱讀器選單，新增功能之後， Youtube 相關的功能變多了，所以將他們獨立出來。

### 修正巷木

1. 修正終止閱讀器時，可能出現選單已被清除的錯誤。
2. 修正沒有在背景定期檢查更新的錯誤。
P.S 我不知道以前的自己在幹嘛，寫了奇怪的邏輯在上面 ...
3. 修正完成 NVDA2023.1 版本測試，但仍提示不相容的錯誤。
P.S 上次測試玩忘了改了xd

---

## V2.61, 2023.3.6

版本代號：Tiny Stars

### 新增項目

1. 嘗試為翻譯人員新增翻譯時的註解，描述需要翻譯內容的出現時機與功能。
2. 新增烏克蘭語言。 感謝 VovaMobile
3. 支援並向下相容 NVDA2023.1 版本

### 修改項目

1. 修改更新時的歌曲播放位置，並將更新時的歌曲移出專案，在更新後生效，也就是說，這首歌是此專案內的最後一首歌，避免專案體積不斷快速長大。

### 修正巷木

1. 在 Firefox Nightly 發現資訊卡提示出現異常時，會導致閱讀字幕功能一起停止的錯誤。
2. 修正無法在 Youtube 影片左右移動時聽取章節的錯誤。

---

## V2.6, 2023.1.18

版本代號：求救訊號

### 新增項目

1. 新增英文語言。
P.S 有了英文語言之後，如果像國外宣傳的話，我就要面對英文版的翻譯錯誤問題，以及英文的意見回饋了，感覺很恐怖！
2. 新增英文版附加元件說明檔案。
P.S 說明檔案室依靠 Chat GPT 還可以用的時候趕快翻譯的，程式內部的文字只能盡量靠自己翻譯了，因為當時 Chat GPT 流量過高而無法使用。
Chat GPT 免費時間似乎正在倒數，把握時間多利用起來。
另外覺得要將附加元件翻譯成其他語言，對於一般使用者還是很麻煩，需要安裝不只一個軟體，還要進行一些與翻譯無關的操作，這不是一個好的現況。

### 修改項目

1. 開啟更新日至：從原本開啟 Markdown 檔案，改為開啟轉換後的 html 檔案。

### 修正巷木

1. 修正字幕閱讀器在終止時，由於沒有完全清除選單，導致 NVDA 出現沒有回應的錯誤。
P.S 此錯誤間接導致了 NVDA 重新啟動變慢，以及關閉 NVDA 可能會再次啟動的錯誤，最嚴重還會出現手動關閉 NVDA 並立刻點選執行檔案或潔淨啟動 NVDA 電腦變得非常緩慢的嚴重問題。
以上問題都是我經歷過的，所以先跟大家說聲抱歉。
最初我以為是聲音模組導致的，甚至嘗試換掉模組且考慮過放棄 NVDA2019.2.1 版本的支援，結果誤會了它非常久，也繞了很長的彎路，最終的結論就是 wx 真的是個又奇怪又麻煩的東西 ...

---

## V2.54, 2022.10.1

版本代號：溫暖的回憶

### 修正巷木

1. 修正由於 Netflix 播放介面改版，導致閱讀器在 Chrome 與 Firefox 都找不到字幕的問題。

---

## V2.53, 2022.9.28

版本代號：アクアテラリウム

### 修改項目

1. 自動檢查更新的間隔，從每天改為每 2 小時。

### 修正巷木

1. 修正 NVDA 版本 2019.2.1 無法閱讀中文字幕的錯誤。
2. 修正「字幕閱讀器」選單當中，「自動檢查更新」功能表項目的勾選狀態，與設定檔案不一致的錯誤。
3. 修正「字幕閱讀器」附加元件無法被正確終止並重新啟動的錯誤。

---

## V2.52, 2022.9.20

### 修正巷木

1. 修正某些狀況下，在 Chrome 找不到 KKTV 字幕的問題。

---

## V2.51, 2022.9.20

### 新增巷木

1. KKTV 新增 Firefox 支援。

### 修正巷木

1. 修正 KKTV 在快進貨快退之後，需要使用 tab 重新取得焦點才能繼續閱讀字幕的錯誤。
2. 修正 py3 nvda 在 Youtube 不獨字幕的錯誤。
P.S 我忘了 py3 沒有 unicode type 了 ... 

---

## V2.5, 2022.9.20

版本代號：禰豆子

### 新增巷木

1. 新增 KKTV 字幕支援。
測試影片：[派對咖孔明](https://www.kktv.me/play/06001387010001)

---

## V2.48, 2022.9.17

版本代號：清歌踏月

### 修正巷木

1. 之前的修正，導致 Beta5 的測試影片問題重現，故這一版修正她。
2. 閱讀字幕的間隔改回 100 毫秒，已修正容易讀取到不完整字幕的問題。

P.S 一直以來，每一次修正字幕被重複朗讀的問題，都是作用於所有影片的，並非只作用於針對的影片，故希望每次修正能夠對多部影片有效，且不讓原本正常的影片出現字幕重複朗讀的問題。
每次修正我都會找出過去版本的測試影片來確認是否受到影響，而這次 Beta5 的影片是被我遺漏沒測到的。

---

## V2.47, 2022.9.4

版本代號：雨滴之歌

### 修改項目

1. 縮短閱讀字幕的間隔，從 100 毫秒改為 5 毫秒。
2. 所有計時器，改用 NVDA 提供的 gui.NonReEntrantTimer 雖然目前是不知道差在哪啦
3. 根據 NVDA 附加元件樣板，修改專案資料夾，故從版本代號「旭日微光」以及之前的版本，已經無法檢查更新，已經過了一個月，還是沒跟上的話，請到檔案下載平台、 NVDA 台灣，或是 github 手動下載並安裝新版本。

### 修正巷木

1. 嘗試盡可能避免執行此附加元件不斷拋出異常。
2. 重構部分代碼

---

## V2.46, 2022.8.4

版本代號：棠梨煎雪

### 新增項目

1. 新增多語言框架支援，使此附加元件可被翻譯為多語言。

### 修正項目

1. 重寫過濾多行重複字幕的功能，以修正此影片字幕被重複朗讀的錯誤。
影片：[summertime (cinnamons × evening cinema) - Cover by 杏仁ミルｘセイ★星文](https://www.youtube.com/watch?v=SulmskKPkOw)
P.S 明明可以很簡單，為何以前的我想得很複雜 ...

---

## V2.44, 2022.7.10

版本代號：旭日微光

李李鈴蘭畢業典禮，就在今天QAQ

### 修正巷木

1. Chrome 瀏覽器，嘗試修正 Disney Plus 每次改版就不讀字幕的錯誤。
現在開始，下次 Disney Plus 改版，嘗試讓字幕閱讀器不會找不到字幕。
測試影片：[SPY×FAMILY](https://www.disneyplus.com/zh-hant/series/spyfamily/fet1h9jqmrAM)

P.S 還以為只有 Netflix 有這部動畫，這下可以繼續追了。

---

## V2.43, 2022.6.9

版本代號： Raising Heart

### 新增項目

1. 新增 Youtube 頻道宣傳影片的字幕支援。
測試連結：[KSP 的頻道，宣傳影片：【KSP】撥条少女時計【歌ってみた】](https://www.youtube.com/c/KSPKSP)
測試方式：點開上面的連結，會進入 KSP 的 Youtube 頻道首頁，若您沒有訂閱 KSP 的頻道，則會在頻道首頁出現宣傳影片，請將焦點移至影片播放器，若您是 Firefox 瀏覽器使用者，影片不會立即開始播放，請點擊播放按鈕。由於目前該頻道的宣傳影片有提供 CC 字幕，則可在播放時聽取字幕內容。

### 修正巷木

1. 此次複雜的修正，全是參考 KSP 宣傳影片當中的字幕內容。
影片：[【KSP】撥条少女時計【歌ってみた】](https://www.youtube.com/watch?v=LFLyLIfcueQ&ab_channel=KSP)
  1. 修正字幕閱讀器只會閱讀 Youtube 字幕第一行的錯誤。
  之前參考影片《 Embrace 》修正的，其實並非多行字幕，而是同一行字幕被拆分成多個區塊而已。
  這次參考的影片，確實能夠使用瀏覽模式瀏覽到多行的字幕內容，之前的參考影片，使用瀏覽模式查看，結果都只有單行字幕。
  2. 修正此參考影片會不斷朗讀相同字幕內容的錯誤。
  問題產生原因：可能為了視覺效果，此歌曲的影片字幕會顯示許多行相同的歌詞，有些還會再不訂行出現上一句歌詞，且每一行位於開頭與結尾還會出現不定數量的空格與一個特殊符號。
  處理方式：檢查字幕的每一行，過濾掉開頭與結尾的空格與特殊符號，然後在其他字幕行尋找是否有相同的字幕內容，若有則將其刪除。
  

P.S 第一次寫到卡關卡超九，每次寫完，測試結果都失敗，繼續找可能問題的概念。 KSP 為啥填這樣的字幕還被我看到 (X
打倒 KSP!

---

## V2.41, 2022.5.29

版本代號： If Only

### 修正巷木

1. 修正在使用 Chrome 瀏覽器聽讀字幕時，當 Youtube 沒有顯示字幕，會不斷引發亦常，且導致中斷 Marumaru 抓取字幕的錯誤。

---

## V2.4, 2022.5.26

版本代號： Friends

### 新增項目

1. 新增 WikiMedia Commons 的字幕支援。
測試影片：[Emily Temple-Wood](https://commons.wikimedia.org/wiki/File:Emily_Temple-Wood_(2minutes27seconds).webm)
測試方式：點選連結，進入頁面之後，按下 Play Media 按鈕，然後在 Captions 功能表選擇字幕語言。
感謝來自香港的朋友 T.Y. 的提案，雖然這裡看起來中文字幕的影片還太少，但願未來能夠繼續增加。

---

## V2.33, 2022.5.23

版本代號：約定的天空

### 修正巷木

1. 修正 Disney+ 無法閱讀字幕的問題。
測試影片：[冰雪奇緣2](https://www.disneyplus.com/zh-hant/video/74351ae5-f6cd-4464-aeb6-8f4b10ca2649)

---

## V2.32, 2022.5.22

版本代號：夢中的世界

### 新增項目

1. 現在可以從《字幕閱讀器》功能表開啟更新日誌檔案，預防更新時沒看到日誌的狀況。

### 修正巷木

1. 在以下影片發現字幕被重複朗讀的問題，原因是此影片連續出現兩次多行字幕，而兩次出現的字幕，各只有其中一行相同而沒有忽略相同內容所導致。
所以現在起，加入使用字幕的每一行來尋找相同點的功能。
影片：[《 Embrace 》 復甦島2主題曲 Official Music Video｜Leggy、Paroto｜玩樂幫](https://www.youtube.com/watch?v=lc7mhbfg5sY&ab_channel=%E7%8E%A9%E6%A8%82%E5%B9%AB)
P.S: 追隨卡蜜拉！~~

---

## V2.31, 2022.4.4

### 新增項目

1. 字幕閱讀器，現在會朗讀 Netflix 的預覽影片，通常預覽影片會出現在選擇影片級數的對話框。

### 修正巷木

1. 修正當意外抓不到字幕時，會誤判字幕已經消失，導致相同字幕被不斷朗讀的錯誤。
發現此問題的影片：[secret base ～你給我的東西～（10 years after Ver.）](https://www.jpmarumaru.com/tw/JPSongPlay-1345.html)

---

## V2.3, 2022.4.3

### 修改項目

1. 字幕閱讀原則修改：若新的字幕內容是前一字幕開頭的一部分，則不在報讀。
2. 嘗試讓字幕閱讀器附加元件縮小。

### 修正巷木

1. 修正 Netflix 偶爾會重複朗讀多行字幕的全部或一部分的錯誤。
2. 修正沒有字幕時，經過 1 秒鐘沒有清除當前字幕紀錄的錯誤。

---

## V2.23, 2022.3.29

### 新增項目

1. 新增相容性代碼，提前支援 NVDA2022.1. 
2. 說明檔案新增字幕閱讀器的 NVDA 相容性說明。

---

## V2.22, 2022.3.27

### 新增項目

1. 新增中文 - 香港說明檔案。
2. 逐步開始新增一些偵錯資訊，事件紀錄在資訊等級不會記錄他們。

### 修正巷木

1. 修正 Disney+ 無法閱讀字幕的錯誤。
2. 修正字幕閱讀器本身的文字錯誤。

---

## V2.2, 2022.3.22

### 新增項目

1. 新增 Netflix 字幕支援。
測試影片：[庫洛魔法使：透明牌篇 - 小櫻和兔子和月之歌](https://www.netflix.com/watch/80995962?trackId=14170289&tctx=2%2C0%2C9ef5c8f2-42a7-433c-9f56-f808e8b08534-153578124%2C49eb2250-db6e-40ea-81e1-f499f5f033ee_218390925X3XX1647885067214%2C49eb2250-db6e-40ea-81e1-f499f5f033ee_ROOT%2C%2C%2C)
P.S 透明牌篇之後的內容啥時候要出啦啦啦！

### 修改項目

1. 啟動時檢查更新：改為自動檢查更新，其行為除了在字幕閱讀器啟動時檢查更新，同時也在一天後再次檢查更新。
但若一天後的最新版本與啟動時檢查的最新版本相同，則不再詢問使用者是否需要更新。

---

## V2.11

### 新增項目

1. 發現新版本之後，其版本號現在顯示在新版資訊的視窗標題。
2. 加入簡體中文的說明檔案。

### 修正巷木

1. 修正 Disney+ 影片播放器全螢幕時不讀字幕的錯誤。
2. 修正 Disney+ 非中文台灣語言介面不讀字幕的錯誤。

---

## V2.1, 2022.2.1

### 新增項目

1. 新增 Brave 瀏覽器支援（感謝 Kevin Lin 的提案）。
P.S 我真的把他給忘了。
2. 在 github 建立[專案](https://github.com/maxe-hsieh/subtitle_reader)。

### 修改項目

1. 更換自動更新的 server 端。
P.S 之前的 server 端很不穩定，如果下載失敗的話，請手動到 [NVDA 台灣](https://www.nvda.tw) 下載。
2. 補充 readme 檔案內容。

### 修正巷木

1. 修正 Edge 不獨字幕的問題。
P.S 沒有人發現，真是太棒了！

---

## V2.0, 2022.01.26

### 新增項目

1. 本次更新亮點：新增 Disney Plus 字幕支援。感謝遊戲創作團隊成員 Serena 的提案。
我的測試影片：[魔法滿屋](https://www.disneyplus.com/zh-hant/movies/encanto/33q7DY1rtHQH)
2. 新增自動檢查更新的功能。
P.S 我在自動更新當中加入很多魔法音效，沒錯我很無聊。

### 修改項目

1. 「Youtube 字幕閱讀器」已改名為「字幕閱讀器」。
*重要*：為避免附加元件衝突，請將 Youtube 字幕閱讀器移除在安裝此附加元件。
2. 以新學的設計模式，嘗試拆散代碼至多個檔案。
P.S 你們相偎相依，我看了不開心。

## 正式版本 V1.0

### 新增項目

1. 新增網站（唱歌學日語 Marumaru ）網站的字幕支援
點擊以下連結，進入我用來測試的歌曲頁面，然後按 b 直接找到內嵌的 Youtube 影片當中的撥放按紐，點選以撥放影片並聽讀字幕。
我的測試歌曲：[群青](https://www.jpmarumaru.com/tw/JPSongPlay-16018.html)
P.S 此功能原本是為了我喜歡一邊聽日文歌一邊聽字幕而做，所以目前只尋找中文字幕來閱讀，並沒有閱讀日文字幕。且這個功能已經偏離此附加元件的主題了，所以就不再說明書上編寫相關說明了，就當作此附加元件的小彩但吧。
2. 新增 Microsoft Edge 支援（感謝 Eureka 提供參考代碼）。
3. 新增 NVDA2021 支援（感謝我們的遊戲創作團隊成員 Serena 協助測試 NVDA 最新版本相容性。

### 修正巷木

1. 修正當影片長度超過一天時，自動閱讀章節的閱讀內容錯誤。

## Beta5

### 新增項目

1. 新增自動閱讀當前章節的功能。
注意：由於 NVDA 並不會時時更新元件的 value 屬性資訊，所以此功能只在案左右方向鍵快進快退時能絕對準確的閱讀章節。

### 修改項目

1. 針對一部影片進行以下調整：
   1. 刪除字幕中出現的一個可能適用於視覺效果的符號。
   2. 調整當畫面上沒有字幕時，必須經過一秒鐘，才會清除 Youtube 字幕閱讀器的字幕緩衝區。
   3. 當多行字幕當中，兩行字幕相同時，將忽略重複的一行字幕。
   4. 此次更新所針對的影片：[ニャタタリズム（貓踏踏的節奏）](https://youtu.be/N468yled-ro)

---
## Beta4

### 修正巷木

1. 修正 Youtube 網頁更新，導致 NVDA 找不到字幕的問題。

---

## Beta3

### 新增項目

1. 新增資訊卡音效提示，音效來源為 Youtube 工作室。
2. 完成測試並新增 NVDA Python3 支援。

---

## Beta2

### 新增項目

1. 新增多行字幕支援。
2. 新增閱讀字幕的開關，預設快速鍵為 NVDA+y 可在輸入手勢中更改。
3. 新增填充字幕規則，例如當前字幕為 (abc), 下一行字幕為 (abcdef), 則在下一行字幕出現時， NVDA 只讀出補充的 (def). 
4. 新增說明文件

---

### 修改項目

1. 每次尋找字幕的間隔，從 5 毫秒改為 100 毫秒，減低壓力。
2. 現在，尋找字幕元件的方式改為元件 id 識別，避免 NVDA 讀取到資訊卡並將資訊卡誤認為字幕。
3. 現在，若影片當前沒有字幕，則清除字幕緩衝區，因此，當下一行字幕與被清除前的字幕相同時可再次閱讀。

---

### 修正巷木

1. 修正當字幕為空白或只有換行符號時， NVDA 會讀出空行的錯誤。
2. 修正 Firefox 將字幕的每個文字拆分成多個元素，導致 NVDA 只讀字幕第一個字的錯誤

---

## Beta1
第一個公開測試版本

---
